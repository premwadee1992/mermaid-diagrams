<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Loss Diagram</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: false });

        async function fetchDataAndRender() {
            let mermaidSyntax = `sequenceDiagram
                participant EYE
                participant store_command as "store-command"
                participant stock_count_adjusts as "DB:store.stock_count_adjusts"
                participant stock_count_groups as "DB:store.stock_count_groups"
                participant outbox_events as "DB:store.outbox_events"
                participant financial_stream as "store-financial-stream"
                participant sale_tax_summary as "DB:sale_tax_summary"

                EYE->>store_command: finalStockCountAdjustment
                store_command->>/stores/count/finalStockCountAdjustment: â‘  Request

                store_command->>stock_count_adjusts: â‘¡ save
                store_command-->>outbox_events: â‘¢ publish event STOCK_COUNT_ADJUST_CREATED
                financial_stream->>outbox_events: â‘£ subscribe STOCK_COUNT_ADJUST_CREATED

                alt adjustStockService.handleStockAdjustAutoCreatedSaleTaxSummary
                    financial_stream->>sale_tax_summary: â‘¤ adjustAmount < 0? Prepare sale tax summary data for Auto IA
                end
                financial_stream->>sale_tax_summary: save
            `;

            document.getElementById("mermaid-diagram").innerHTML = `<div class="mermaid">${mermaidSyntax}</div>`;
            mermaid.init(undefined, document.querySelectorAll(".mermaid"));
        }

        document.addEventListener("DOMContentLoaded", fetchDataAndRender);
    </script>
</head>
<body>
    <h2>ðŸ“Œ Stock Loss Diagram</h2>
    <div id="mermaid-diagram"></div>
</body>
</html>
